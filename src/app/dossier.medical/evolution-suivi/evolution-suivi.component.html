<div [formGroup]="form" class="space-y-8 gap-6 animate-fade-in-up ">
    <div class="form-card-3d space-y-4 ">
        <div class="flex items-center gap-3 ">
            <mat-icon class="text-indigo-600 bg-indigo-100 p-2 rounded-full shadow-sm ">note_alt</mat-icon>
            <h3 class="text-xl font-semibold text-gray-900 ">Notes D'Evolution</h3>
        </div>
        <div class="space-y-4 ">
            <div class="flex items-center gap-2 ">
                <mat-form-field appearance="fill" class="flex-1 ">
                    <mat-label>Nouvelle Note</mat-label>
                    <textarea matInput [formControl]="notesControl " placeholder="Ex : Suivi de traitement, évolution clinique... " (keydown.enter)="addNote() " rows="3 ">

                    </textarea>
                    <mat-error *ngIf="form.get( 'note')?.hasError( 'required') ">Note requise</mat-error>
                </mat-form-field>
                <button mat-icon-button color="primary " (click)="addNote() " [disabled]="!notesControl.value?.trim() " class="hover:bg-blue-100 rounded-full ">
                    <mat-icon>add</mat-icon>
                </button>
            </div>
        </div>


        <mat-chip-listbox multiple class="w-full mt-4 ">
            <mat-chip *ngFor="let note of notesEvolution.controls; let i=index " [removable]="true " (removed)="removeNote(i) ">
                {{ note.value }}
                <button matChipRemove aria-label="Supprimer la note ">
                    <mat-icon>close</mat-icon>
                </button>
            </mat-chip>
        </mat-chip-listbox>
    </div>

    <div class="form-card-3d space-y-4 p-4 ">
        <div class="flex items-center gap-3 ">
            <mat-icon class="text-green-600 bg-green-100 p-2 rounded-full shadow-sm ">medical_services</mat-icon>
            <h3 class="text-xl font-semibold text-gray-900 ">Courbes Cliniques</h3>
        </div>

        <div *ngFor="let courbe of form.get( 'courbes')?.value; " class="bg-white rounded-lg shadow p-4 mb-4 ">
            <h4 class="text-lg font-medium text-gray-800 mb-2 ">{{courbe.type}}</h4>
            <div echarts [options]="getChartOptions(courbe) " class="h-64 w-full "></div>
        </div>
        <button mat-stroked-button color="primary " (click)="openAddCourbeDialog() ">
            <mat-icon>add</mat-icon> Ajouter une courbe clinique
        </button>
    </div>

    <div class="form-card-3d space-y-4 ">
        <div class="flex items-center gap-3 ">
            <mat-icon class="text-blue-600 bg-blue-100 p-2 rounded-full shadow-sm ">medical_services</mat-icon>
            <h3 class="text-xl font-semibold text-gray-900 ">Consultations de Suivi</h3>
        </div>

        <div *ngFor="let consultation of consultations.controls; let i=index " class=" p-4 border rounded-lg flex justify-between items-center ">
            <div>
                <p class="font-medium text-gray-800 mb-2 ">Médecin: {{ consultation.value.medecin.nom }}</p>
                <p class="text-gray-600 ">Date: {{ consultation.value.date | date: 'shortDate' }}</p>
                <p class="text-gray-600 ">Résumé: {{ consultation.value.resume }}</p>
            </div>
            <button mat-icon-button color="warn " (click)="removeConsultation(i) ">
                <mat-icon>delete</mat-icon>
            </button>
        </div>
        <button mat-stroked-button color="primary " (click)="openAddConsultationDialog() ">
            <mat-icon>add</mat-icon> Ajouter une consultation de suivi
        </button>
    </div>