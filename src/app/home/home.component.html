<app-sidebar></app-sidebar>

<div class="main-container ml-72 p-6 grid grid-cols-1 md:grid-cols-2 gap-6">
    <!-- Formulaire am√©lior√© -->
    <div class="form-container glass-card p-8 rounded-2xl shadow-lg border border-gray-200 space-y-6">
        <h2 class="form-title text-2xl font-bold text-gray-800 mb-4 flex items-center gap-2">
            <i class="bi bi-calendar2-check text-green-600 text-3xl"></i> Prise de rendez-vous
        </h2>

        <!-- Champ Adresse -->
        <div class="input-group">
            <label for="adresse" class="input-label">Adresse</label>
            <div class="input-wrapper">
                <i class="bi bi-geo-alt text-gray-500"></i>
                <input id="adresse" type="text" [(ngModel)]="searchQuery" (keyup.enter)="searchLocation()" placeholder="Adresse d√©tect√©e ou saisissez une adresse..." />
            </div>
            <p class="hint-text">Modifiez l‚Äôadresse et appuyez sur Entr√©e pour rechercher.</p>
        </div>

        <!-- Sp√©cialit√© -->
        <div class="input-group">
            <label for="specialite" class="input-label">Sp√©cialit√©</label>
            <div class="input-wrapper">
                <i class="bi bi-heart-pulse text-gray-500"></i>
                <select id="specialite" [(ngModel)]="selectedSpecialite" (change)="search()">
          <option value="">-- Choisir une sp√©cialit√© --</option>
          <option *ngFor="let s of specialites" [value]="s">{{ s }}</option>
        </select>
            </div>
        </div>

        <!-- Tarif Max -->
        <div class="input-group">
            <label for="tarif" class="input-label">Tarif maximum (XOF)</label>
            <div class="input-wrapper">
                <i class="bi bi-cash-stack text-gray-500"></i>
                <input type="number" id="tarif" [(ngModel)]="tarifMax" (change)="search()" />
            </div>
        </div>

        <!-- Rayon -->
        <div class="input-group">
            <label for="rayon" class="input-label">Rayon (km)</label>
            <div class="input-wrapper">
                <i class="bi bi-arrows-expand text-gray-500"></i>
                <input type="number" id="rayon" [(ngModel)]="rayonKm" (change)="search()" />
            </div>
        </div>

        <!-- Professionnel -->
        <div class="input-group">
            <label for="pro" class="input-label">Professionnel</label>
            <div class="input-wrapper">
                <i class="bi bi-person-badge text-gray-500"></i>
                <select id="pro" [(ngModel)]="selectedPro" (change)="onProSelected()">
          <option [ngValue]="null">-- Choisir un professionnel --</option>
          <option *ngFor="let pro of filteredPros" [ngValue]="pro">
            {{ pro.prenom }} {{ pro.nom }} ‚Äî {{ pro.specialite }}
          </option>
        </select>
            </div>
        </div>

        <!-- Date -->
        <div class="input-group">
            <label for="date" class="input-label">Date</label>
            <div class="input-wrapper">
                <i class="bi bi-calendar-event text-gray-500"></i>
                <input type="date" id="date" [(ngModel)]="rendezVousDate" (change)="onDateSelected()" />
            </div>
        </div>

        <!-- Cr√©neaux -->
        <div class="input-group" *ngIf="creneauxDisponibles.length > 0">
            <label for="creneau" class="input-label">Cr√©neau disponible</label>
            <div class="input-wrapper">
                <i class="bi bi-clock text-gray-500"></i>
                <select id="creneau" [(ngModel)]="selectedCreneau">
          <option *ngFor="let c of creneauxDisponibles" [value]="c">{{ c | date: 'shortTime' }}</option>
        </select>
            </div>
        </div>

        <!-- Bouton -->
        <button (click)="prendreRendezVous()" class="btn-primary w-full">
      <i class="bi bi-check2-circle"></i> Prendre rendez-vous
    </button>
    </div>

    <!-- Carte -->
    <div>
        <div id="map" class="map-card rounded-xl shadow-lg"></div>
    </div>
</div>

<!-- ‚ùå Modal erreur -->
<div *ngIf="showErrorModal" class="fixed inset-0 flex items-center justify-center z-50">
    <div class="absolute inset-0 bg-opacity-40 backdrop-blur-sm" (click)="fermerErrorModal()"></div>
    <div class="glass-card relative max-w-md w-full p-6 rounded-2xl shadow-xl animate-fadeInUp z-10">
        <div class="flex justify-center mb-4">
            <i class="bi bi-exclamation-triangle-fill text-red-500 text-5xl"></i>
        </div>
        <h3 class="text-xl font-bold text-center text-gray-800 mb-2">Informations manquantes</h3>
        <p class="text-center text-gray-600 mb-4">
            Veuillez s√©lectionner un praticien, une date et un cr√©neau pour continuer.
        </p>
        <div class="flex justify-center">
            <button (click)="fermerErrorModal()" class="bg-red-500 text-white px-6 py-2 rounded-lg shadow hover:bg-red-600 transition">
        OK
      </button>
        </div>
    </div>
</div>

<!-- ‚úÖ Modal confirmation -->
<div *ngIf="showSuccessModal" class="fixed inset-0 flex items-center justify-center z-50">
    <div class="absolute inset-0 bg-opacity-40 backdrop-blur-sm" (click)="fermerSuccessModal()"></div>
    <div class="glass-card relative max-w-md w-full p-8 rounded-2xl shadow-2xl animate-fadeInUp z-10">
        <div class="flex justify-center mb-6">
            <i class="bi bi-check-circle-fill text-green-500 text-6xl"></i>
        </div>
        <h2 class="text-2xl font-bold text-center text-gray-800 mb-4">Rendez-vous confirm√© üéâ</h2>
        <p class="text-center text-gray-600 mb-6">
            Votre rendez-vous avec
            <span class="font-semibold">{{ selectedPro?.prenom }} {{ selectedPro?.nom }}</span> est confirm√© pour le
            <span class="font-semibold">{{ rendezVousDate | date: 'fullDate' }}</span> √† <span class="font-semibold">{{ selectedCreneau }}</span>.
        </p>
        <div class="flex justify-center gap-4">
            <button (click)="fermerSuccessModal()" class="bg-gray-200 text-gray-700 px-6 py-2 rounded-xl shadow hover:bg-gray-300 transition flex-1">
        Fermer
      </button>
            <button (click)="allerMesRdv()" class="bg-blue-600 text-white px-6 py-2 rounded-xl shadow hover:bg-blue-700 transition flex-1">
        Voir mes rendez-vous
      </button>
        </div>
    </div>
</div>